var jkyoutubeapidfd=$.Deferred();function onYouTubeIframeAPIReady(){jkyoutubeapidfd.resolve()}!function($){document.createElement("figure"),document.createElement("figcaption");var youtubeplayer=null,videoaspectratio=1.77,isYoutubeReg=/(youtube?\.com|youtu\.be)/i,youTubeIdReg=/(youtube?\.com|youtu\.be)\/(watch\?v=|v\/|u\/|embed\/?)?([\w-]{11})(.*)?/i,captionclass="rcaption",KEYCODE_ESC=27;KEYCODE_LEFT=37,KEYCODE_RIGHT=39;var updatedimensionstimer=null,defaults={autoclose:!0,media:[],fxduration:150},galleryui='<div class="responsivegallery"><div class="galleryinner"><div class="figurearea"></div><div class="close"><span class="icon-cross"></span></div><div class="leftnav"><span class="icon-arrow-left"></span></div><div class="rightnav"><span class="icon-arrow-right"></span></div><div class="loadingdiv"><span class="icon-spinner"></span></div><div class="errordiv"><span class="icon-cancel-circle"></span></div></div></div>';function buildfigure(mediafigure,curmedia,totalmedia){var countermarkup=totalmedia>1?'<span class="counter">'+(curmedia+1)+"/"+totalmedia+"</span>":"",figurehtml="<figure>\n";return figurehtml+='<img src="'+mediafigure[0]+'" />\n',(mediafigure[1]||totalmedia>1)&&(figurehtml+='<figcaption class="thecaption"><div class="captioninner">'+countermarkup+(mediafigure[1]||"")+"</div></figcaption>\n"),figurehtml+="</figure>"}function buildvideocontainer(mediafigure,curmedia,totalmedia){var countermarkup=totalmedia>1?'<span class="counter">'+(curmedia+1)+"/"+totalmedia+"</span>":"",videohtml='<div class="jkvideocontainer">\n';return videohtml+='<div class="jkvideowrapper"><div id="jkvideotemp"></div></div>\n',(mediafigure[1]||totalmedia>1)&&(videohtml+='<div class="thecaption"><div class="captioninner">'+countermarkup+(mediafigure[1]||"")+"</div></div>\n"),videohtml+="</div>"}function preloadmedia(mediaurl,callback){var callback=callback||function(){};if(isYoutubeReg.test(mediaurl))callback();else{var preload=new Image;preload.onload=function(){callback()},preload.onerror=function(){callback("error")},preload.src=mediaurl}}var responsivegallery={$galleryui:null,$galleryinner:null,$loadingdiv:null,loadingdivtimer:null,$errordiv:null,$galleryfigurearea:null,activesettings:null,activegallery:{media:[],curmedia:0,mediashown:[],startingmedia:null},buildgalleryui:function(){this.$galleryui=$(galleryui).appendTo(document.body),this.$galleryinner=this.$galleryui.find("div.galleryinner"),this.$loadingdiv=this.$galleryui.find("div.loadingdiv"),this.$errordiv=this.$galleryui.find("div.errordiv"),this.$galleryfigurearea=this.$galleryui.find("div.figurearea");var $closebutt=this.$galleryui.find("div.close"),$leftnav=this.$galleryui.find("div.leftnav"),$rightnav=this.$galleryui.find("div.rightnav");$(document).on("keyup",(function(e){"block"==responsivegallery.$galleryui.css("display")&&(27==e.keyCode?responsivegallery.hidegallery():e.keyCode==KEYCODE_LEFT&&responsivegallery.activegallery.media.length>1?responsivegallery.navigate("prev"):e.keyCode==KEYCODE_RIGHT&&responsivegallery.activegallery.media.length>1&&responsivegallery.navigate("next"))})),this.$galleryui.on("click",(function(){responsivegallery.hidegallery()})),this.$galleryfigurearea.on("click",(function(e){e.stopPropagation()})),$leftnav.on("click",(function(e){responsivegallery.navigate("prev"),e.stopPropagation()})),$rightnav.on("click",(function(e){responsivegallery.navigate("next"),e.stopPropagation()})),$(window).on("resize.adjustuidimensions",(function(){if("block"==responsivegallery.$galleryui.css("display"))if(responsivegallery.$galleryfigurearea.hasClass("isvideo")){var captionheight=responsivegallery.$galleryinner.find("div.thecaption").height()||0,maxheight,maxwidth=1.77*(responsivegallery.$galleryinner.height()-captionheight)-30;maxwidth>1e3&&(maxwidth-=100),responsivegallery.$galleryfigurearea.css({width:maxwidth})}else{var $galleryimg;responsivegallery.$galleryfigurearea.find("img:eq(0)").css("maxHeight",responsivegallery.$galleryinner.height()-10),responsivegallery.$galleryfigurearea.css({width:"auto"})}}));var swipeOptions={triggerOnTouchEnd:!0,triggerOnTouchLeave:!0,fallbackToMouseEvents:!1,swipethreshold:75,excludedElements:[],swipeStatus:function(event,phase,direction,distance){if("end"==phase){var navkeyword=/(right)/i.test(direction)?"prev":"next";responsivegallery.navigate(navkeyword)}}};this.$galleryfigurearea.swipe&&this.$galleryinner.swipe(swipeOptions)},destroyvideoplayer:function(){null!=youtubeplayer&&(youtubeplayer.destroy(),youtubeplayer=null)},showgallery:function(){var $navbuttons;this.$galleryui.find("div.leftnav, div.rightnav").css("display",this.activegallery.media.length>1?"block":"none"),this.$galleryui.fadeIn(this.activesettings.fxduration)},hidegallery:function(){this.destroyvideoplayer(),this.$galleryfigurearea.empty(),this.$galleryui.fadeOut(this.activesettings.fxduration)},populategallery:function(){var media=this.activegallery.media,curmedia=this.activegallery.curmedia,targetfigure=media[curmedia];clearTimeout(this.loadingdivtimer),this.destroyvideoplayer(),this.loadingdivtimer=setTimeout((function(){responsivegallery.$loadingdiv.css("display","block")}),50),this.$errordiv.css("display","none"),preloadmedia(media[curmedia][0],(function(err){if(err){clearTimeout(responsivegallery.loadingdivtimer),responsivegallery.$loadingdiv.css("display","none"),responsivegallery.$galleryfigurearea.empty(),responsivegallery.$errordiv.css("display","block").attr("title","Error loading "+media[curmedia][0]);var $gallerymedia=responsivegallery.$galleryfigurearea.find("img:eq(0)"),$figcaptioninner=responsivegallery.$galleryfigurearea.find("figcaption div.captioninner")}else{var isvideo;isYoutubeReg.test(media[curmedia][0])?(responsivegallery.$galleryfigurearea.addClass("isvideo"),responsivegallery.$galleryfigurearea.empty().html(buildvideocontainer(media[curmedia],curmedia,media.length)),jkyoutubeapidfd.then((function(){youtubeplayer=new YT.Player("jkvideotemp",{videoId:youTubeIdReg.exec(media[curmedia][0])[3],playerVars:{autoplay:1},events:{onReady:function(e){clearTimeout(responsivegallery.loadingdivtimer),responsivegallery.$loadingdiv.css("display","none")}}})}))):(clearTimeout(responsivegallery.loadingdivtimer),responsivegallery.$loadingdiv.css("display","none"),responsivegallery.$galleryfigurearea.removeClass("isvideo"),responsivegallery.$galleryfigurearea.empty().html(buildfigure(media[curmedia],curmedia,media.length)))}responsivegallery.$galleryui.css("display","block"),$(window).trigger("resize.adjustuidimensions"),responsivegallery.$galleryfigurearea.find("figure").css({transitionDuration:responsivegallery.activesettings.fxduration/1e3+"s",opacity:1})}))},navigate:function(keyword){var media=this.activegallery.media,curmedia=this.activegallery.curmedia,startingmedia=this.activegallery.startingmedia,mediashown=this.activegallery.mediashown,targetmedia="next"==keyword?curmedia<media.length-1?curmedia+1:0:"prev"==keyword?curmedia>0?curmedia-1:media.length-1:parseInt(keyword);this.activesettings.autoclose&&"all"==mediashown[mediashown.length-1]&&targetmedia==startingmedia?this.hidegallery():(-1==jQuery.inArray(targetmedia,mediashown)&&mediashown.push(targetmedia),this.activegallery.curmedia=targetmedia,this.populategallery(),media.length>1&&mediashown.length>=media.length&&this.activesettings.autoclose&&mediashown.push("all"))}};$.fn.responsivegallery=function(settings){var matches=this.length,media=[];return this.each((function(i){var s=$.extend({},defaults,settings),$t=$(this),enlargedmedia,$galleryui=$("div.responsivegallery"),enlargemediarc,caption;$t.data("pos",i),enlargedmedia=[$t.is("a")?$t.attr("href"):$t.find("a:eq(0)").attr("href"),1==$t.find("div.rcaption").length?$t.find("div.rcaption").html():$t.attr("title")],media.push(enlargedmedia),1==matches&&(media=media.concat(s.media)),$t.on("click",(function(e){e.preventDefault(),responsivegallery.activesettings=s,responsivegallery.activegallery={media:media,curmedia:$(this).data("pos"),mediashown:[$(this).data("pos")],startingmedia:$(this).data("pos")},responsivegallery.populategallery(),responsivegallery.showgallery()})),0==$galleryui.length&&responsivegallery.buildgalleryui()}))}}(jQuery);